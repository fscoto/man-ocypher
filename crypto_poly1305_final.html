<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <link rel="stylesheet" href="style.css" type="text/css" media="all"/>
  <title>CRYPTO_POLY1305_AUTH(3MONOCYPHER)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">CRYPTO_POLY1305_AUTH(3MONOCYPHER)</td>
    <td class="head-vol">3MONOCYPHER</td>
    <td class="head-rtitle">CRYPTO_POLY1305_AUTH(3MONOCYPHER)</td>
  </tr>
</table>
<div class="manual-text">
<h1 class="Sh" title="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<code class="Nm" title="Nm">crypto_poly1305</code>,
  <code class="Nm" title="Nm">crypto_poly1305_init</code>,
  <code class="Nm" title="Nm">crypto_poly1305_update</code>,
  <code class="Nm" title="Nm">crypto_poly1305_final</code> &#x2014;
<div class="Nd" title="Nd">Poly1305 one-time message authentication codes</div>
<h1 class="Sh" title="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<code class="In" title="In">#include
  &lt;<a class="In" title="In">monocypher.h</a>&gt;</code>
<div class="Pp"></div>
<var class="Ft" title="Ft">void</var>
<br/>
<code class="Fn" title="Fn">crypto_poly1305</code>(<var class="Fa" title="Fa">uint8_t
  mac[16]</var>, <var class="Fa" title="Fa">const uint8_t *message</var>,
  <var class="Fa" title="Fa">size_t message_size</var>,
  <var class="Fa" title="Fa">const uint8_t key[32]</var>);
<div class="Pp"></div>
<var class="Ft" title="Ft">void</var>
<br/>
<code class="Fn" title="Fn">crypto_poly1305_init</code>(<var class="Fa" title="Fa">crypto_poly1305_ctx
  *ctx</var>, <var class="Fa" title="Fa">const uint8_t key[32]</var>);
<div class="Pp"></div>
<var class="Ft" title="Ft">void</var>
<br/>
<code class="Fn" title="Fn">crypto_poly1305_update</code>(<var class="Fa" title="Fa">crypto_poly1305_ctx
  *ctx</var>, <var class="Fa" title="Fa">const uint8_t *message</var>,
  <var class="Fa" title="Fa">size_t message_size</var>);
<div class="Pp"></div>
<var class="Ft" title="Ft">void</var>
<br/>
<code class="Fn" title="Fn">crypto_poly1305_final</code>(<var class="Fa" title="Fa">crypto_poly1305_ctx
  *ctx</var>, <var class="Fa" title="Fa">uint8_t mac[16]</var>);
<h1 class="Sh" title="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
Poly1305 is a one-time message authentication code. &quot;One-time&quot; means
  the authentication key can be used only once. <b class="Sy" title="Sy">This
  makes Poly1305 easy to misuse</b>. On the other hand, Poly1305 is fast, and
  provably secure if used correctly.
<div class="Pp"></div>
Poly1305 is a low-level primitive. Consider using authenticated encryption,
  implemented by
  <a class="Xr" title="Xr" href="crypto_lock.html">crypto_lock(3monocypher)</a>.
<div class="Pp"></div>
The arguments are:
<dl class="Bl-tag">
  <dt>&#x00A0;</dt>
  <dd>&#x00A0;</dd>
  <dt><var class="Fa" title="Fa">mac</var></dt>
  <dd>The authentication code.</dd>
  <dt>&#x00A0;</dt>
  <dd>&#x00A0;</dd>
  <dt><var class="Fa" title="Fa">key</var></dt>
  <dd>The secret authentication key. Use only once per message. Do not use the
      session key to authenticate messages. It should be wiped with
      <a class="Xr" title="Xr" href="crypto_wipe.html">crypto_wipe(3monocypher)</a>
      after use.</dd>
  <dt>&#x00A0;</dt>
  <dd>&#x00A0;</dd>
  <dt><var class="Fa" title="Fa">message</var></dt>
  <dd>The message to authenticate. May overlap with the
      <var class="Fa" title="Fa">mac</var> argument.</dd>
  <dt>&#x00A0;</dt>
  <dd>&#x00A0;</dd>
  <dt><var class="Fa" title="Fa">message_size</var></dt>
  <dd>Length of <var class="Fa" title="Fa">message</var>, in bytes.</dd>
</dl>
<h2 class="Ss" title="Ss" id="Direct_interface"><a class="permalink" href="#Direct_interface">Direct
  interface</a></h2>
<code class="Fn" title="Fn">crypto_poly1305</code>() produces a message
  authentication code for the given message and authentication key. To verify
  the integrity of a message, use
  <a class="Xr" title="Xr" href="crypto_verify16.html">crypto_verify16(3monocypher)</a>
  to compare the received MAC to the output
  <var class="Fa" title="Fa">mac</var>.
<h2 class="Ss" title="Ss" id="Incremental_interface"><a class="permalink" href="#Incremental_interface">Incremental
  interface</a></h2>
<code class="Fn" title="Fn">crypto_poly1305_init</code>() initialises a context.
  <var class="Fa" title="Fa">key</var> should be wiped once the context is
  initialised. Then, <code class="Fn" title="Fn">crypto_poly1305_update</code>()
  authenticates the message chunk by chunk. Once the message is entirely
  processed, <code class="Fn" title="Fn">crypto_poly1305_final</code>() yields
  the message authentication code.
<h1 class="Sh" title="Sh" id="RETURN_VALUES"><a class="permalink" href="#RETURN_VALUES">RETURN
  VALUES</a></h1>
These functions return nothing.
<h1 class="Sh" title="Sh" id="EXAMPLES"><a class="permalink" href="#EXAMPLES">EXAMPLES</a></h1>
To authenticate a message:
<div class="Pp"></div>
<div class="Bd Bd-indent">
<pre class="Li">
const uint8_t msg[500]; /* Message to authenticate           */ 
const uint8_t key[ 32]; /* Random secret key (use only once) */ 
uint8_t       mac[ 16]; /* Message authentication code (MAC) */ 
crypto_poly1305(mac, msg, 500, key); 
/* Wipe the key */ 
crypto_wipe(key, 32);
</pre>
</div>
<div class="Pp"></div>
To verify the above message:
<div class="Pp"></div>
<div class="Bd Bd-indent">
<pre class="Li">
const uint8_t msg     [500]; /* Message to verify */ 
const uint8_t key     [ 32]; /* The above key     */ 
const uint8_t mac     [ 16]; /* The above MAC     */ 
uint8_t       real_mac[ 16]; /* The actual MAC    */ 
crypto_poly1305(real_mac, msg, 500, key); 
/* Wipe the key */ 
crypto_wipe(key, 32); 
if (crypto_verify16(mac, real_mac)) { 
    /* Corrupted message, abort processing */ 
} else { 
    /* Genuine message */ 
} 
/* The real mac is secret.  Wipe it */ 
crypto_wipe(real_mac, 16);
</pre>
</div>
<div class="Pp"></div>
Incremental authentication:
<div class="Pp"></div>
<div class="Bd Bd-indent">
<pre class="Li">
const uint8_t msg[500]; /* Message to authenticate           */ 
const uint8_t key[ 32]; /* Random secret key (use only once) */ 
uint8_t       mac[ 16]; /* Message authentication code (MAC) */ 
crypto_poly1305_ctx ctx; 
crypto_poly1305_init(&amp;ctx, key); 
/* Wipe the key */ 
crypto_wipe(key, 32); 
for (int i = 0; i &lt; 500; i += 100) { 
    crypto_poly1305_update(&amp;ctx, msg, 100); 
} 
crypto_poly1305_final(&amp;ctx, mac);
</pre>
</div>
<h1 class="Sh" title="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<a class="Xr" title="Xr" href="crypto_blake2b.html">crypto_blake2b(3monocypher)</a>,
  <a class="Xr" title="Xr" href="crypto_lock.html">crypto_lock(3monocypher)</a>,
  <a class="Xr" title="Xr" href="crypto_verify16.html">crypto_verify16(3monocypher)</a>,
  <a class="Xr" title="Xr" href="intro.html">intro(3monocypher)</a>
<h1 class="Sh" title="Sh" id="STANDARDS"><a class="permalink" href="#STANDARDS">STANDARDS</a></h1>
These functions implement Poly1305, described in RFC 8439.
<h1 class="Sh" title="Sh" id="SECURITY_CONSIDERATIONS"><a class="permalink" href="#SECURITY_CONSIDERATIONS">SECURITY
  CONSIDERATIONS</a></h1>
Poly1305 is difficult to use correctly. Do not use it unless you are absolutely
  sure what you are doing. Use authenticated encryption instead; see
  <a class="Xr" title="Xr" href="crypto_lock.html">crypto_lock(3monocypher)</a>.
  If you are certain you do not want encryption, refer to
  <a class="Xr" title="Xr" href="crypto_blake2b.html">crypto_blake2b(3monocypher)</a>
  on how to use Blake2b to generate message authentication codes.
<h2 class="Ss" title="Ss" id="Authentication_key_requirements"><a class="permalink" href="#Authentication_key_requirements">Authentication
  key requirements</a></h2>
Poly1305 is a <i class="Em" title="Em">one time</i> authenticator. This puts
  rather stringent constraints on the authentication key:
<ul class="Bl-bullet">
  <li>Any given key must be used only once. Using the same key for two different
      messages reveals it to the attacker. Do not use the session key, or it
      will void all security.</li>
  <li>Authentication keys must be random, and independent from each other. Do
      not use non-random nonces. Do not use related keys. Use fresh,
      unpredictable, uniformly distributed random numbers.</li>
  <li>The key must be transmitted to the recipient without revealing it to the
      attacker. Somehow.</li>
</ul>
<div class="Pp"></div>
The only practical source for the authentication key is a chunk of the
  encryption stream used to encrypt the message. That chunk must be
  <i class="Em" title="Em">dedicated</i> to the authentication key: if it is
  reused to encrypt the message itself, the attacker may recover that chunk by
  guessing the message, then forge arbitrary messages.
<div class="Pp"></div>
To get this right, you need a session key, a <i class="Em" title="Em">unique</i>
  nonce, and a stream cipher. Generate a stream with the session key and nonce.
  Take the first 32 bytes of that stream as your authentication key, then use
  the <i class="Em" title="Em">rest</i> of the stream to encrypt your message.
  This is the approach used by
  <a class="Xr" title="Xr" href="crypto_lock_aead.html">crypto_lock_aead(3monocypher)</a>.
<h2 class="Ss" title="Ss" id="Protection_against_side_channels"><a class="permalink" href="#Protection_against_side_channels">Protection
  against side channels</a></h2>
Use
  <a class="Xr" title="Xr" href="crypto_verify16.html">crypto_verify16(3monocypher)</a>
  to compare message authentication codes. Avoid standard buffer comparison
  functions. They may not run in constant time, enabling an attacker to exploit
  timing attacks to recover the MAC.
<div class="Pp"></div>
The authentication key should be wiped with
  <a class="Xr" title="Xr" href="crypto_wipe.html">crypto_wipe(3monocypher)</a>
  after use.
<div class="Pp"></div>
The incremental interface automatically wipes its context when finished so users
  do not need to do it themselves.</div>
<table class="foot">
  <tr>
    <td class="foot-date">December 28, 2017</td>
    <td class="foot-os">OpenBSD 6.4</td>
  </tr>
</table>
</body>
</html>
